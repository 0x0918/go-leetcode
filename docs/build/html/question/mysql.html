

<!DOCTYPE html>
<html class="writer-html4" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Easy &mdash; go-leetcode v1.0.0 文档</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="PAT (Basic Level) Practice 乙级" href="patB.html" />
    <link rel="prev" title="LCP" href="lcp.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> go-leetcode
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="0001-0100.html">0001-0100-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="0001-0100.html#medium">0001-0100-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="0001-0100.html#hard">0001-1000-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="0101-0200.html">0101-0200-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="0101-0200.html#medium">0101-0200-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="0101-0200.html#hard">0101-0200-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="0201-0300.html">0201-0300-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="0201-0300.html#medium">0201-0300-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="0201-0300.html#hard">0201-0300-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="0301-0400.html">0301-0400-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="0301-0400.html#medium">0301-0400-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="0301-0400.html#hard">0301-0400-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="0401-0500.html">0401-0500-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="0401-0500.html#medium">0401-0500-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="0401-0500.html#hard">0401-0500-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="0501-0600.html">0501-0600-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="0501-0600.html#medium">0501-0600-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="0501-0600.html#hard">0501-0600-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="0601-0700.html">0601-0700-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="0601-0700.html#medium">0601-0700-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="0601-0700.html#hard">0601-0700-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="0701-0800.html">0701-0800-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="0701-0800.html#medium">0701-0800-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="0701-0800.html#hard">0701-0800-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="0801-0900.html">0801-0900-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="0801-0900.html#medium">0801-0900-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="0801-0900.html#hard">0801-0900-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="0901-1000.html">0901-1000-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="0901-1000.html#medium">0901-1000-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="0901-1000.html#hard">0901-1000-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="1001-1100.html">1001-1100-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="1001-1100.html#medium">1001-1100-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="1001-1100.html#hard">1001-1100-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="1101-1200.html">1101-1200-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="1101-1200.html#medium">1101-1200-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="1101-1200.html#hard">1101-1200-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="1201-1300.html">1201-1300-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="1201-1300.html#medium">1201-1300-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="1201-1300.html#hard">1201-1300-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="1301-1400.html">1301-1400-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="1301-1400.html#medium">1301-1400-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="1301-1400.html#hard">1301-1400-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="1401-1500.html">1401-1500-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="1401-1500.html#medium">1401-1500-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="1401-1500.html#hard">1401-1500-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="1501-1600.html">1501-1600-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="1501-1600.html#medium">1501-1600-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="1501-1600.html#hard">1501-1600-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="1601-1700.html">1601-1700-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="1601-1700.html#medium">1601-1700-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="1601-1700.html#hard">1601-1700-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="1701-1800.html">1701-1800-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="1701-1800.html#medium">1701-1800-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="1701-1800.html#hard">1701-1800-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="1801-1900.html">1801-1900-Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="1801-1900.html#medium">1801-1900-Medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="1801-1900.html#hard">1801-1900-Hard</a></li>
<li class="toctree-l1"><a class="reference internal" href="offer.html">剑指offer</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcci.html">程序员面试金典</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcp.html">LCP</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Easy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">175.组合两个表(2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">176.第二高的薪水(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">181.超过经理收入的员工(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">182.查找重复的电子邮箱(2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">183.从不订购的客户(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">193.删除重复的电子邮箱(2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">197.上升的温度(4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">595.大的国(2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">596.超过5名学生的课(2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id10">620.有趣的电影(2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id11">627.交换工资(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">1179.重新格式化部门表(2)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#medium">Medium</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#n-2">177.第N高的薪水(2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id13">178.分数排名(2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id14">180.连续出现的数字(1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id15">184.部门工资最高的员工(2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id16">626.换座位(2)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#hard">Hard</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id17">185.部门工资前三高的所有员工(2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id18">262.行程和用户(2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id19">601.体育馆的人流量(2)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="patB.html">PAT (Basic Level) Practice 乙级</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">go-leetcode</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Easy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/question/mysql.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>mysql</p>
<ul class="simple">
<li><a class="reference external" href="#mysql">mysql</a><ul>
<li><a class="reference external" href="#175%E7%BB%84%E5%90%88%E4%B8%A4%E4%B8%AA%E8%A1%A82">175.组合两个表(2)</a></li>
<li><a class="reference external" href="#176%E7%AC%AC%E4%BA%8C%E9%AB%98%E7%9A%84%E8%96%AA%E6%B0%B43">176.第二高的薪水(3)</a></li>
<li><a class="reference external" href="#181%E8%B6%85%E8%BF%87%E7%BB%8F%E7%90%86%E6%94%B6%E5%85%A5%E7%9A%84%E5%91%98%E5%B7%A53">181.超过经理收入的员工(3)</a></li>
<li><a class="reference external" href="#182%E6%9F%A5%E6%89%BE%E9%87%8D%E5%A4%8D%E7%9A%84%E7%94%B5%E5%AD%90%E9%82%AE%E7%AE%B12">182.查找重复的电子邮箱(2)</a></li>
<li><a class="reference external" href="#183%E4%BB%8E%E4%B8%8D%E8%AE%A2%E8%B4%AD%E7%9A%84%E5%AE%A2%E6%88%B73">183.从不订购的客户(3)</a></li>
<li><a class="reference external" href="#193%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D%E7%9A%84%E7%94%B5%E5%AD%90%E9%82%AE%E7%AE%B12">193.删除重复的电子邮箱(2)</a></li>
<li><a class="reference external" href="#197%E4%B8%8A%E5%8D%87%E7%9A%84%E6%B8%A9%E5%BA%A64">197.上升的温度(4)</a></li>
<li><a class="reference external" href="#595%E5%A4%A7%E7%9A%84%E5%9B%BD2">595.大的国(2)</a></li>
<li><a class="reference external" href="#596%E8%B6%85%E8%BF%875%E5%90%8D%E5%AD%A6%E7%94%9F%E7%9A%84%E8%AF%BE2">596.超过5名学生的课(2)</a></li>
<li><a class="reference external" href="#620%E6%9C%89%E8%B6%A3%E7%9A%84%E7%94%B5%E5%BD%B12">620.有趣的电影(2)</a></li>
<li><a class="reference external" href="#627%E4%BA%A4%E6%8D%A2%E5%B7%A5%E8%B5%843">627.交换工资(3)</a></li>
<li><a class="reference external" href="#1179%E9%87%8D%E6%96%B0%E6%A0%BC%E5%BC%8F%E5%8C%96%E9%83%A8%E9%97%A8%E8%A1%A82">1179.重新格式化部门表(2)</a></li>
</ul>
</li>
</ul>
<div class="section" id="easy">
<h1>Easy<a class="headerlink" href="#easy" title="永久链接至标题">¶</a></h1>
<div class="section" id="id1">
<h2>175.组合两个表(2)<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL架构
Create table Person (PersonId int, FirstName varchar(255), LastName varchar(255))
Create table Address (AddressId int, PersonId int, City varchar(255), State varchar(255))
Truncate table Person
insert into Person (PersonId, LastName, FirstName) values (&#39;1&#39;, &#39;Wang&#39;, &#39;Allen&#39;)
Truncate table Address
insert into Address (AddressId, PersonId, City, State) values (&#39;1&#39;, &#39;2&#39;, &#39;New York City&#39;, &#39;New York&#39;)

表1: Person
+-------------+---------+
| 列名         | 类型     |
+-------------+---------+
| PersonId    | int     |
| FirstName   | varchar |
| LastName    | varchar |
+-------------+---------+
PersonId 是上表主键

表2: Address
+-------------+---------+
| 列名         | 类型    |
+-------------+---------+
| AddressId   | int     |
| PersonId    | int     |
| City        | varchar |
| State       | varchar |
+-------------+---------+
AddressId 是上表主键

编写一个 SQL 查询，满足条件：无论 person 是否有地址信息，都需要基于上述两表提供 person 的以下信息：
FirstName, LastName, City, State
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>考察join的基本使用</td>
</tr>
<tr>
<td>02</td>
<td>考察join的基本使用</td>
</tr>
</tbody>
</table><div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="n">FirstName</span><span class="p">,</span> <span class="n">LastName</span><span class="p">,</span> <span class="n">City</span><span class="p">,</span> <span class="n">State</span> 
<span class="k">from</span> <span class="n">Person</span> <span class="k">left</span> <span class="k">join</span> <span class="n">Address</span> <span class="k">on</span> <span class="n">Person</span><span class="p">.</span><span class="n">PersonId</span> <span class="o">=</span> <span class="n">Address</span><span class="p">.</span><span class="n">PersonId</span>

<span class="c1">#</span>
<span class="k">select</span> <span class="n">A</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">City</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">State</span>
<span class="k">from</span> <span class="n">Person</span> <span class="n">A</span>
<span class="k">left</span> <span class="k">join</span> <span class="p">(</span><span class="k">select</span> <span class="k">distinct</span> <span class="n">PersonId</span><span class="p">,</span> <span class="n">City</span><span class="p">,</span> <span class="n">State</span> <span class="k">from</span> <span class="n">Address</span><span class="p">)</span> <span class="n">B</span>
<span class="k">on</span> <span class="n">A</span><span class="p">.</span><span class="n">PersonId</span><span class="o">=</span><span class="n">B</span><span class="p">.</span><span class="n">PersonId</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2>176.第二高的薪水(3)<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL架构
Create table If Not Exists Employee (Id int, Salary int)
Truncate table Employee
insert into Employee (Id, Salary) values (&#39;1&#39;, &#39;100&#39;)
insert into Employee (Id, Salary) values (&#39;2&#39;, &#39;200&#39;)
insert into Employee (Id, Salary) values (&#39;3&#39;, &#39;300&#39;)

编写一个 SQL 查询，获取 Employee 表中第二高的薪水（Salary） 。
+----+--------+
| Id | Salary |
+----+--------+
| 1  | 100    |
| 2  | 200    |
| 3  | 300    |
+----+--------+

例如上述 Employee 表，SQL查询应该返回 200 作为第二高的薪水。
如果不存在第二高的薪水，那么查询应返回 null。
+---------------------+
| SecondHighestSalary |
+---------------------+
| 200                 |
+---------------------+
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>把select语句包起来，使空的时候为null</td>
</tr>
<tr>
<td>02</td>
<td>使用ifnull</td>
</tr>
<tr>
<td>03</td>
<td>先查出最大的，然后查出比最大小的</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span><span class="p">(</span>
    <span class="k">select</span> <span class="k">distinct</span> <span class="n">Salary</span> 
    <span class="k">from</span> <span class="n">Employee</span> 
    <span class="k">order</span> <span class="k">by</span> <span class="n">Salary</span> <span class="k">desc</span>
    <span class="k">limit</span> <span class="mi">1</span> <span class="k">offset</span> <span class="mi">1</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">SecondHighestSalary</span><span class="p">;</span>

<span class="o">#</span>
<span class="k">select</span> <span class="n">ifnull</span><span class="p">(</span>
    <span class="p">(</span><span class="k">select</span> <span class="k">distinct</span> <span class="n">Salary</span> 
    <span class="k">from</span> <span class="n">Employee</span> 
    <span class="k">order</span> <span class="k">by</span> <span class="n">Salary</span> <span class="k">desc</span>
    <span class="k">limit</span> <span class="mi">1</span> <span class="k">offset</span> <span class="mi">1</span><span class="p">),</span><span class="k">null</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">SecondHighestSalary</span><span class="p">;</span>

<span class="o">#</span> 
<span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">Salary</span><span class="p">)</span> <span class="k">as</span> <span class="n">SecondHighestSalary</span> 
<span class="k">from</span> <span class="n">Employee</span> 
<span class="k">where</span> <span class="n">Salary</span> <span class="o">&lt;</span> <span class="p">(</span><span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">Salary</span><span class="p">)</span> <span class="k">from</span> <span class="n">Employee</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>181.超过经理收入的员工(3)<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL架构
Create table If Not Exists Employee (Id int, Name varchar(255), Salary int, ManagerId int)
Truncate table Employee
insert into Employee (Id, Name, Salary, ManagerId) values (&#39;1&#39;, &#39;Joe&#39;, &#39;70000&#39;, &#39;3&#39;)
insert into Employee (Id, Name, Salary, ManagerId) values (&#39;2&#39;, &#39;Henry&#39;, &#39;80000&#39;, &#39;4&#39;)
insert into Employee (Id, Name, Salary, ManagerId) values (&#39;3&#39;, &#39;Sam&#39;, &#39;60000&#39;, &#39;None&#39;)
insert into Employee (Id, Name, Salary, ManagerId) values (&#39;4&#39;, &#39;Max&#39;, &#39;90000&#39;, &#39;None&#39;)

Employee 表包含所有员工，他们的经理也属于员工。
每个员工都有一个 Id，此外还有一列对应员工的经理的 Id。

+----+-------+--------+-----------+
| Id | Name  | Salary | ManagerId |
+----+-------+--------+-----------+
| 1  | Joe   | 70000  | 3         |
| 2  | Henry | 80000  | 4         |
| 3  | Sam   | 60000  | NULL      |
| 4  | Max   | 90000  | NULL      |
+----+-------+--------+-----------+

给定 Employee 表，编写一个 SQL 查询，该查询可以获取收入超过他们经理的员工的姓名。
在上面的表格中，Joe 是唯一一个收入超过他的经理的员工。

+----------+
| Employee |
+----------+
| Joe      |
+----------+
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>使用笛卡尔乘积，和方法2一样</td>
</tr>
<tr>
<td>02</td>
<td>使用内链接</td>
</tr>
<tr>
<td>03</td>
<td>子查询</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="n">Name</span> <span class="k">AS</span> <span class="s1">&#39;Employee&#39;</span>
<span class="k">FROM</span> <span class="n">Employee</span> <span class="k">AS</span> <span class="n">a</span><span class="p">,</span> <span class="n">Employee</span> <span class="k">AS</span> <span class="n">b</span>
<span class="k">WHERE</span> <span class="n">a</span><span class="p">.</span><span class="n">ManagerId</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">Id</span> <span class="k">AND</span> <span class="n">a</span><span class="p">.</span><span class="n">Salary</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">Salary</span><span class="p">;</span>

<span class="o">#</span>
<span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="n">Name</span> <span class="k">AS</span> <span class="s1">&#39;Employee&#39;</span>
<span class="k">FROM</span> <span class="n">Employee</span> <span class="k">AS</span> <span class="n">a</span> <span class="k">join</span> <span class="n">Employee</span> <span class="k">AS</span> <span class="n">b</span>
<span class="k">on</span> <span class="n">a</span><span class="p">.</span><span class="n">ManagerId</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">Id</span> <span class="k">AND</span> <span class="n">a</span><span class="p">.</span><span class="n">Salary</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">Salary</span><span class="p">;</span>

<span class="o">#</span>
<span class="k">select</span> <span class="n">name</span> <span class="k">as</span> <span class="n">Employee</span> 
<span class="k">from</span> <span class="n">employee</span> <span class="n">a</span> 
<span class="k">where</span> <span class="n">salary</span> <span class="o">&gt;</span> <span class="p">(</span><span class="k">select</span> <span class="n">salary</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span> <span class="n">a</span><span class="p">.</span><span class="n">managerid</span> <span class="o">=</span> <span class="n">id</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h2>182.查找重复的电子邮箱(2)<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL架构
Create table If Not Exists Person (Id int, Email varchar(255))
Truncate table Person
insert into Person (Id, Email) values (&#39;1&#39;, &#39;a@b.com&#39;)
insert into Person (Id, Email) values (&#39;2&#39;, &#39;c@d.com&#39;)
insert into Person (Id, Email) values (&#39;3&#39;, &#39;a@b.com&#39;)

编写一个 SQL 查询，查找 Person 表中所有重复的电子邮箱。
示例：
+----+---------+
| Id | Email   |
+----+---------+
| 1  | a@b.com |
| 2  | c@d.com |
| 3  | a@b.com |
+----+---------+

根据以上输入，你的查询应返回以下结果：
+---------+
| Email   |
+---------+
| a@b.com |
+---------+

说明：所有电子邮箱都是小写字母。
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>使用临时表</td>
</tr>
<tr>
<td>02</td>
<td>使用having子句</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="n">Email</span> <span class="k">from</span>
<span class="p">(</span>
    <span class="k">select</span> <span class="n">Email</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="n">Email</span><span class="p">)</span> <span class="k">as</span> <span class="n">num</span>
    <span class="k">from</span> <span class="n">Person</span> 
    <span class="k">Group</span> <span class="k">by</span> <span class="n">Email</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">temp_table</span> 
<span class="k">where</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span>

<span class="o">//</span>
<span class="k">select</span> <span class="n">Email</span> 
<span class="k">from</span> <span class="n">Person</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">Email</span>
<span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="n">Email</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h2>183.从不订购的客户(3)<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL架构
Create table If Not Exists Customers (Id int, Name varchar(255))
Create table If Not Exists Orders (Id int, CustomerId int)
Truncate table Customers
insert into Customers (Id, Name) values (&#39;1&#39;, &#39;Joe&#39;)
insert into Customers (Id, Name) values (&#39;2&#39;, &#39;Henry&#39;)
insert into Customers (Id, Name) values (&#39;3&#39;, &#39;Sam&#39;)
insert into Customers (Id, Name) values (&#39;4&#39;, &#39;Max&#39;)
Truncate table Orders
insert into Orders (Id, CustomerId) values (&#39;1&#39;, &#39;3&#39;)
insert into Orders (Id, CustomerId) values (&#39;2&#39;, &#39;1&#39;)
某网站包含两个表，Customers 表和 Orders 表。编写一个 SQL 查询，找出所有从不订购任何东西的客户。

Customers 表：
+----+-------+
| Id | Name  |
+----+-------+
| 1  | Joe   |
| 2  | Henry |
| 3  | Sam   |
| 4  | Max   |
+----+-------+

Orders 表：
+----+------------+
| Id | CustomerId |
+----+------------+
| 1  | 3          |
| 2  | 1          |
+----+------------+

例如给定上述表格，你的查询应返回：
+-----------+
| Customers |
+-----------+
| Henry     |
| Max       |
+-----------+
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>使用not in</td>
</tr>
<tr>
<td>02</td>
<td>左连接</td>
</tr>
<tr>
<td>03</td>
<td>使用not exists</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="n">Customers</span><span class="p">.</span><span class="n">Name</span> <span class="k">as</span> <span class="n">Customers</span>
<span class="k">from</span> <span class="n">Customers</span>
<span class="k">where</span> <span class="n">Customers</span><span class="p">.</span><span class="n">Id</span> <span class="k">not</span> <span class="k">in</span> <span class="p">(</span>
    <span class="k">select</span> <span class="n">CustomerId</span> <span class="k">from</span> <span class="n">Orders</span>
<span class="p">);</span>

<span class="o">#</span>
<span class="k">select</span> <span class="n">a</span><span class="p">.</span><span class="n">Name</span> <span class="k">as</span> <span class="n">Customers</span>
<span class="k">from</span> <span class="n">Customers</span> <span class="k">as</span> <span class="n">a</span> <span class="k">left</span> <span class="k">join</span> <span class="n">Orders</span> <span class="k">as</span> <span class="n">b</span> <span class="k">on</span> <span class="n">a</span><span class="p">.</span><span class="n">Id</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">CustomerId</span>
<span class="k">where</span> <span class="n">b</span><span class="p">.</span><span class="n">CustomerId</span> <span class="k">is</span> <span class="k">null</span><span class="p">;</span>

<span class="o">#</span>
<span class="k">select</span> <span class="n">name</span> <span class="n">Customers</span> 
<span class="k">from</span> <span class="n">customers</span> <span class="k">c</span> 
<span class="k">where</span> <span class="k">not</span> <span class="k">exists</span> <span class="p">(</span>
    <span class="k">select</span> <span class="mi">1</span> <span class="k">from</span> <span class="n">orders</span> <span class="n">o</span> 
    <span class="k">where</span> <span class="n">o</span><span class="p">.</span><span class="n">customerid</span><span class="o">=</span><span class="k">c</span><span class="p">.</span><span class="n">id</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h2>193.删除重复的电子邮箱(2)<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>编写一个 SQL 查询，来删除 Person 表中所有重复的电子邮箱，重复的邮箱里只保留 Id 最小 的那个。
+----+------------------+
| Id | Email            |
+----+------------------+
| 1  | john@example.com |
| 2  | bob@example.com  |
| 3  | john@example.com |
+----+------------------+
Id 是这个表的主键。
例如，在运行你的查询语句之后，上面的 Person 表应返回以下几行:
+----+------------------+
| Id | Email            |
+----+------------------+
| 1  | john@example.com |
| 2  | bob@example.com  |
+----+------------------+
提示：
    执行 SQL 之后，输出是整个 Person 表。
    使用 delete 语句。
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>使用delete+自连接</td>
</tr>
<tr>
<td>02</td>
<td>使用delete，根据group by和min()查询出最小的id</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">#</span> 
<span class="k">delete</span> <span class="n">p1</span> <span class="k">from</span> <span class="n">Person</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Person</span> <span class="n">P2</span> 
<span class="k">where</span> <span class="n">p1</span><span class="p">.</span><span class="n">Email</span> <span class="o">=</span> <span class="n">p2</span><span class="p">.</span><span class="n">Email</span> <span class="k">and</span> <span class="n">p1</span><span class="p">.</span><span class="n">Id</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">.</span><span class="n">Id</span>

<span class="o">#</span>
<span class="k">delete</span> <span class="k">from</span> <span class="n">Person</span>
<span class="k">where</span> <span class="n">id</span> <span class="k">not</span> <span class="k">in</span> <span class="p">(</span>
    <span class="k">select</span> <span class="n">id</span> <span class="k">from</span> <span class="p">(</span>
        <span class="k">select</span> <span class="k">min</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">as</span> <span class="n">id</span>
        <span class="k">from</span> <span class="n">Person</span>
        <span class="k">group</span> <span class="k">by</span> <span class="n">Email</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">temp_table</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h2>197.上升的温度(4)<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL架构
Create table If Not Exists Weather (Id int, RecordDate date, Temperature int)
Truncate table Weather
insert into Weather (Id, RecordDate, Temperature) values (&#39;1&#39;, &#39;2015-01-01&#39;, &#39;10&#39;)
insert into Weather (Id, RecordDate, Temperature) values (&#39;2&#39;, &#39;2015-01-02&#39;, &#39;25&#39;)
insert into Weather (Id, RecordDate, Temperature) values (&#39;3&#39;, &#39;2015-01-03&#39;, &#39;20&#39;)
insert into Weather (Id, RecordDate, Temperature) values (&#39;4&#39;, &#39;2015-01-04&#39;, &#39;30&#39;)

给定一个 Weather 表，编写一个 SQL 查询，来查找与之前（昨天的）日期相比温度更高的所有日期的 Id。
+---------+------------------+------------------+
| Id(INT) | RecordDate(DATE) | Temperature(INT) |
+---------+------------------+------------------+
|       1 |       2015-01-01 |               10 |
|       2 |       2015-01-02 |               25 |
|       3 |       2015-01-03 |               20 |
|       4 |       2015-01-04 |               30 |
+---------+------------------+------------------+

例如，根据上述给定的 Weather 表格，返回如下 Id:
+----+
| Id |
+----+
|  2 |
|  4 |
+----+
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>自连接和datediff()的使用</td>
</tr>
<tr>
<td>02</td>
<td>自连接和adddate()的使用</td>
</tr>
<tr>
<td>03</td>
<td>自连接和unix_timestamp()的使用</td>
</tr>
<tr>
<td>04</td>
<td>自连接和subdate()的使用</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">#</span>
<span class="k">select</span> <span class="n">A</span><span class="p">.</span><span class="n">Id</span> <span class="k">as</span> <span class="ss">&quot;Id&quot;</span>
<span class="k">from</span> <span class="n">Weather</span> <span class="n">A</span> <span class="k">join</span> <span class="n">Weather</span> <span class="n">B</span>
<span class="k">on</span> <span class="n">datediff</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">RecordDate</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">RecordDate</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">and</span> <span class="n">A</span><span class="p">.</span><span class="n">Temperature</span> <span class="o">&gt;</span> <span class="n">B</span><span class="p">.</span><span class="n">Temperature</span>

<span class="o">#</span>
<span class="k">select</span> <span class="n">A</span><span class="p">.</span><span class="n">Id</span> <span class="k">as</span> <span class="ss">&quot;Id&quot;</span>
<span class="k">from</span> <span class="n">Weather</span> <span class="n">A</span> <span class="k">join</span> <span class="n">Weather</span> <span class="n">B</span>
<span class="k">on</span> <span class="n">A</span><span class="p">.</span><span class="n">Temperature</span> <span class="o">&gt;</span> <span class="n">B</span><span class="p">.</span><span class="n">Temperature</span> <span class="k">and</span> <span class="n">A</span><span class="p">.</span><span class="n">RecordDate</span> <span class="o">=</span> <span class="n">adddate</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">RecordDate</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 

<span class="o">#</span>
<span class="k">select</span> <span class="n">A</span><span class="p">.</span><span class="n">Id</span> <span class="k">as</span> <span class="ss">&quot;Id&quot;</span>
<span class="k">from</span> <span class="n">Weather</span> <span class="n">A</span> <span class="k">join</span> <span class="n">Weather</span> <span class="n">B</span>
<span class="k">on</span> <span class="n">unix_timestamp</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">RecordDate</span><span class="p">)</span> <span class="o">=</span> <span class="n">unix_timestamp</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">RecordDate</span><span class="p">)</span> <span class="o">+</span> <span class="mi">86400</span>
<span class="k">and</span> <span class="n">A</span><span class="p">.</span><span class="n">Temperature</span> <span class="o">&gt;</span> <span class="n">B</span><span class="p">.</span><span class="n">Temperature</span>

<span class="o">#</span>
<span class="k">select</span> <span class="n">A</span><span class="p">.</span><span class="n">Id</span> <span class="k">as</span> <span class="ss">&quot;Id&quot;</span>
<span class="k">from</span> <span class="n">Weather</span> <span class="n">A</span> <span class="k">join</span> <span class="n">Weather</span> <span class="n">B</span>
<span class="k">on</span> <span class="n">A</span><span class="p">.</span><span class="n">Temperature</span> <span class="o">&gt;</span> <span class="n">B</span><span class="p">.</span><span class="n">Temperature</span> <span class="k">and</span> <span class="n">B</span><span class="p">.</span><span class="n">RecordDate</span> <span class="o">=</span> <span class="n">subdate</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">RecordDate</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h2>595.大的国(2)<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Create table If Not Exists World (name varchar(255), continent varchar(255), area int, population int, gdp int)
Truncate table World
insert into World (name, continent, area, population, gdp) values (&#39;Afghanistan&#39;, &#39;Asia&#39;, &#39;652230&#39;, &#39;25500100&#39;, &#39;20343000000&#39;)
insert into World (name, continent, area, population, gdp) values (&#39;Albania&#39;, &#39;Europe&#39;, &#39;28748&#39;, &#39;2831741&#39;, &#39;12960000000&#39;)
insert into World (name, continent, area, population, gdp) values (&#39;Algeria&#39;, &#39;Africa&#39;, &#39;2381741&#39;, &#39;37100000&#39;, &#39;188681000000&#39;)
insert into World (name, continent, area, population, gdp) values (&#39;Andorra&#39;, &#39;Europe&#39;, &#39;468&#39;, &#39;78115&#39;, &#39;3712000000&#39;)
insert into World (name, continent, area, population, gdp) values (&#39;Angola&#39;, &#39;Africa&#39;, &#39;1246700&#39;, &#39;20609294&#39;, &#39;100990000000&#39;)

这里有张 World 表

+-----------------+------------+------------+--------------+---------------+
| name            | continent  | area       | population   | gdp           |
+-----------------+------------+------------+--------------+---------------+
| Afghanistan     | Asia       | 652230     | 25500100     | 20343000      |
| Albania         | Europe     | 28748      | 2831741      | 12960000      |
| Algeria         | Africa     | 2381741    | 37100000     | 188681000     |
| Andorra         | Europe     | 468        | 78115        | 3712000       |
| Angola          | Africa     | 1246700    | 20609294     | 100990000     |
+-----------------+------------+------------+--------------+---------------+

如果一个国家的面积超过300万平方公里，或者人口超过2500万，那么这个国家就是大国家。
编写一个SQL查询，输出表中所有大国家的名称、人口和面积。
例如，根据上表，我们应该输出:
+--------------+-------------+--------------+
| name         | population  | area         |
+--------------+-------------+--------------+
| Afghanistan  | 25500100    | 652230       |
| Algeria      | 37100000    | 2381741      |
+--------------+-------------+--------------+
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>or的使用</td>
</tr>
<tr>
<td>02</td>
<td>union的使用</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>select name, population, area from world
where area &gt; 3000000 or population &gt; 25000000

#
# or具有全表扫描机制
# union具有索引列查询速度快
# Union：对两个结果集进行并集操作，不包括重复行，同时进行默认规则的排序；
# Union All：对两个结果集进行并集操作，包括重复行，不进行排序；
select name, population, area from world where area &gt; 3000000
union
select name, population, area from world where population &gt; 25000000
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h2>596.超过5名学生的课(2)<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Create table If Not Exists courses (student varchar(255), class varchar(255))
Truncate table courses
insert into courses (student, class) values (&#39;A&#39;, &#39;Math&#39;)
insert into courses (student, class) values (&#39;B&#39;, &#39;English&#39;)
insert into courses (student, class) values (&#39;C&#39;, &#39;Math&#39;)
insert into courses (student, class) values (&#39;D&#39;, &#39;Biology&#39;)
insert into courses (student, class) values (&#39;E&#39;, &#39;Math&#39;)
insert into courses (student, class) values (&#39;F&#39;, &#39;Computer&#39;)
insert into courses (student, class) values (&#39;G&#39;, &#39;Math&#39;)
insert into courses (student, class) values (&#39;H&#39;, &#39;Math&#39;)
insert into courses (student, class) values (&#39;I&#39;, &#39;Math&#39;)

有一个courses 表 ，有: student (学生) 和 class (课程)。

请列出所有超过或等于5名学生的课。

例如,表:
+---------+------------+
| student | class      |
+---------+------------+
| A       | Math       |
| B       | English    |
| C       | Math       |
| D       | Biology    |
| E       | Math       |
| F       | Computer   |
| G       | Math       |
| H       | Math       |
| I       | Math       |
+---------+------------+

应该输出:
+---------+
| class   |
+---------+
| Math    |
+---------+
Note:
学生在每个课中不应被重复计算。
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>group by + having</td>
</tr>
<tr>
<td>02</td>
<td>group by + 临时表</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="k">class</span> <span class="k">from</span> <span class="n">courses</span>
<span class="k">group</span> <span class="k">by</span> <span class="k">class</span>
<span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">student</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span>

<span class="o">#</span>
<span class="k">select</span> <span class="k">class</span> <span class="k">from</span> 
<span class="p">(</span><span class="k">select</span> <span class="k">class</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">student</span><span class="p">)</span> <span class="k">as</span> <span class="n">num</span> <span class="k">from</span> <span class="n">courses</span> <span class="k">group</span> <span class="k">by</span> <span class="k">class</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_table</span>
<span class="k">where</span> <span class="n">num</span> <span class="o">&gt;=</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h2>620.有趣的电影(2)<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Create table If Not Exists cinema (id int, movie varchar(255), description varchar(255), rating float(2, 1))
Truncate table cinema
insert into cinema (id, movie, description, rating) values (&#39;1&#39;, &#39;War&#39;, &#39;great 3D&#39;, &#39;8.9&#39;)
insert into cinema (id, movie, description, rating) values (&#39;2&#39;, &#39;Science&#39;, &#39;fiction&#39;, &#39;8.5&#39;)
insert into cinema (id, movie, description, rating) values (&#39;3&#39;, &#39;irish&#39;, &#39;boring&#39;, &#39;6.2&#39;)
insert into cinema (id, movie, description, rating) values (&#39;4&#39;, &#39;Ice song&#39;, &#39;Fantacy&#39;, &#39;8.6&#39;)
insert into cinema (id, movie, description, rating) values (&#39;5&#39;, &#39;House card&#39;, &#39;Interesting&#39;, &#39;9.1&#39;)

某城市开了一家新的电影院，吸引了很多人过来看电影。
该电影院特别注意用户体验，专门有个 LED显示板做电影推荐，上面公布着影评和相关电影描述。
作为该电影院的信息部主管，您需要编写一个 SQL查询，
找出所有影片描述为非 boring (不无聊) 的并且 id 为奇数 的影片，结果请按等级 rating 排列。
例如，下表 cinema:
+---------+-----------+--------------+-----------+
|   id    | movie     |  description |  rating   |
+---------+-----------+--------------+-----------+
|   1     | War       |   great 3D   |   8.9     |
|   2     | Science   |   fiction    |   8.5     |
|   3     | irish     |   boring     |   6.2     |
|   4     | Ice song  |   Fantacy    |   8.6     |
|   5     | House card|   Interesting|   9.1     |
+---------+-----------+--------------+-----------+
对于上面的例子，则正确的输出是为：
+---------+-----------+--------------+-----------+
|   id    | movie     |  description |  rating   |
+---------+-----------+--------------+-----------+
|   5     | House card|   Interesting|   9.1     |
|   1     | War       |   great 3D   |   8.9     |
+---------+-----------+--------------+-----------+
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>mod的使用</td>
</tr>
<tr>
<td>02</td>
<td>常用操作</td>
</tr>
</tbody>
</table><div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">cinema</span>
<span class="k">where</span> <span class="k">mod</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span> <span class="k">and</span> <span class="n">description</span> <span class="o">!=</span> <span class="s1">&#39;boring&#39;</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">rating</span> <span class="k">desc</span>

<span class="c1">#</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">cinema</span>
<span class="k">where</span> <span class="n">id</span><span class="o">%</span><span class="mi">2</span><span class="o">=</span><span class="mi">1</span> <span class="k">and</span> <span class="n">description</span> <span class="o">!=</span> <span class="s1">&#39;boring&#39;</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">rating</span> <span class="k">desc</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h2>627.交换工资(3)<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>create table if not exists salary(id int, name varchar(100), sex char(1), salary int)
Truncate table salary
insert into salary (id, name, sex, salary) values (&#39;1&#39;, &#39;A&#39;, &#39;m&#39;, &#39;2500&#39;)
insert into salary (id, name, sex, salary) values (&#39;2&#39;, &#39;B&#39;, &#39;f&#39;, &#39;1500&#39;)
insert into salary (id, name, sex, salary) values (&#39;3&#39;, &#39;C&#39;, &#39;m&#39;, &#39;5500&#39;)
insert into salary (id, name, sex, salary) values (&#39;4&#39;, &#39;D&#39;, &#39;f&#39;, &#39;500&#39;)
给定一个 salary 表，如下所示，有 m = 男性 和 f = 女性 的值。
交换所有的 f 和 m 值（例如，将所有 f 值更改为 m，反之亦然）。
要求只使用一个更新（Update）语句，并且没有中间的临时表。

注意，您必只能写一个 Update 语句，请不要编写任何 Select 语句。
例如：
| id | name | sex | salary |
|----|------|-----|--------|
| 1  | A    | m   | 2500   |
| 2  | B    | f   | 1500   |
| 3  | C    | m   | 5500   |
| 4  | D    | f   | 500    |
运行你所编写的更新语句之后，将会得到以下表:
| id | name | sex | salary |
|----|------|-----|--------|
| 1  | A    | f   | 2500   |
| 2  | B    | m   | 1500   |
| 3  | C    | f   | 5500   |
| 4  | D    | m   | 500    |
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>update+case</td>
</tr>
<tr>
<td>02</td>
<td>update+if</td>
</tr>
<tr>
<td>03</td>
<td>update+ascii互转</td>
</tr>
</tbody>
</table><div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">update</span> <span class="n">salary</span>
<span class="kt">set</span> <span class="n">sex</span><span class="o">=</span>
<span class="k">CASE</span> <span class="n">sex</span>
<span class="k">when</span> <span class="s1">&#39;m&#39;</span> <span class="k">then</span> <span class="s1">&#39;f&#39;</span>
<span class="k">else</span> <span class="s1">&#39;m&#39;</span>
<span class="n">END</span>

<span class="c1">#</span>
<span class="k">update</span> <span class="n">salary</span>
<span class="kt">set</span> <span class="n">sex</span><span class="o">=</span><span class="k">if</span><span class="p">(</span><span class="n">sex</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>

<span class="c1">#</span>
<span class="k">update</span> <span class="n">salary</span>
<span class="kt">set</span> <span class="n">sex</span><span class="o">=</span><span class="kt">char</span><span class="p">(</span><span class="nf">ascii</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span><span class="o">+</span><span class="nf">ascii</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">)</span><span class="o">-</span><span class="nf">ascii</span><span class="p">(</span><span class="n">sex</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h2>1179.重新格式化部门表(2)<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>部门表 Department：
Create table If Not Exists Department (id int, revenue int, month varchar(5))
Truncate table Department
insert into Department (id, revenue, month) values (&#39;1&#39;, &#39;8000&#39;, &#39;Jan&#39;)
insert into Department (id, revenue, month) values (&#39;2&#39;, &#39;9000&#39;, &#39;Jan&#39;)
insert into Department (id, revenue, month) values (&#39;3&#39;, &#39;10000&#39;, &#39;Feb&#39;)
insert into Department (id, revenue, month) values (&#39;1&#39;, &#39;7000&#39;, &#39;Feb&#39;)
insert into Department (id, revenue, month) values (&#39;1&#39;, &#39;6000&#39;, &#39;Mar&#39;)
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| id            | int     |
| revenue       | int     |
| month         | varchar |
+---------------+---------+
(id, month) 是表的联合主键。
这个表格有关于每个部门每月收入的信息。
月份（month）可以取下列值 [&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;]。
编写一个 SQL 查询来重新格式化表，使得新的表中有一个部门 id 列和一些对应 每个月 的收入（revenue）列。
查询结果格式如下面的示例所示：
Department 表：
+------+---------+-------+
| id   | revenue | month |
+------+---------+-------+
| 1    | 8000    | Jan   |
| 2    | 9000    | Jan   |
| 3    | 10000   | Feb   |
| 1    | 7000    | Feb   |
| 1    | 6000    | Mar   |
+------+---------+-------+
查询得到的结果表：
+------+-------------+-------------+-------------+-----+-------------+
| id   | Jan_Revenue | Feb_Revenue | Mar_Revenue | ... | Dec_Revenue |
+------+-------------+-------------+-------------+-----+-------------+
| 1    | 8000        | 7000        | 6000        | ... | null        |
| 2    | 9000        | null        | null        | ... | null        |
| 3    | null        | 10000       | null        | ... | null        |
+------+-------------+-------------+-------------+-----+-------------+
注意，结果表有 13 列 (1个部门 id 列 + 12个月份的收入列)。
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>group by+case when then end+sum/max</td>
</tr>
<tr>
<td>02</td>
<td>group by+if+sum/max</td>
</tr>
</tbody>
</table><div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="n">id</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">case</span> <span class="n">month</span> <span class="k">when</span> <span class="s1">&#39;Jan&#39;</span> <span class="k">then</span> <span class="n">revenue</span> <span class="n">end</span><span class="p">)</span> <span class="n">Jan_Revenue</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">case</span> <span class="n">month</span> <span class="k">when</span> <span class="s1">&#39;Feb&#39;</span> <span class="k">then</span> <span class="n">revenue</span> <span class="n">end</span><span class="p">)</span> <span class="n">Feb_Revenue</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">case</span> <span class="n">month</span> <span class="k">when</span> <span class="s1">&#39;Mar&#39;</span> <span class="k">then</span> <span class="n">revenue</span> <span class="n">end</span><span class="p">)</span> <span class="n">Mar_Revenue</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">case</span> <span class="n">month</span> <span class="k">when</span> <span class="s1">&#39;Apr&#39;</span> <span class="k">then</span> <span class="n">revenue</span> <span class="n">end</span><span class="p">)</span> <span class="n">Apr_Revenue</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">case</span> <span class="n">month</span> <span class="k">when</span> <span class="s1">&#39;May&#39;</span> <span class="k">then</span> <span class="n">revenue</span> <span class="n">end</span><span class="p">)</span> <span class="n">May_Revenue</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">case</span> <span class="n">month</span> <span class="k">when</span> <span class="s1">&#39;Jun&#39;</span> <span class="k">then</span> <span class="n">revenue</span> <span class="n">end</span><span class="p">)</span> <span class="n">Jun_Revenue</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">case</span> <span class="n">month</span> <span class="k">when</span> <span class="s1">&#39;Jul&#39;</span> <span class="k">then</span> <span class="n">revenue</span> <span class="n">end</span><span class="p">)</span> <span class="n">Jul_Revenue</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">case</span> <span class="n">month</span> <span class="k">when</span> <span class="s1">&#39;Aug&#39;</span> <span class="k">then</span> <span class="n">revenue</span> <span class="n">end</span><span class="p">)</span> <span class="n">Aug_Revenue</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">case</span> <span class="n">month</span> <span class="k">when</span> <span class="s1">&#39;Sep&#39;</span> <span class="k">then</span> <span class="n">revenue</span> <span class="n">end</span><span class="p">)</span> <span class="n">Sep_Revenue</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">case</span> <span class="n">month</span> <span class="k">when</span> <span class="s1">&#39;Oct&#39;</span> <span class="k">then</span> <span class="n">revenue</span> <span class="n">end</span><span class="p">)</span> <span class="n">Oct_Revenue</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">case</span> <span class="n">month</span> <span class="k">when</span> <span class="s1">&#39;Nov&#39;</span> <span class="k">then</span> <span class="n">revenue</span> <span class="n">end</span><span class="p">)</span> <span class="n">Nov_Revenue</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">case</span> <span class="n">month</span> <span class="k">when</span> <span class="s1">&#39;Dec&#39;</span> <span class="k">then</span> <span class="n">revenue</span> <span class="n">end</span><span class="p">)</span> <span class="n">Dec_Revenue</span>
<span class="k">from</span> <span class="n">department</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">id</span><span class="p">;</span>

<span class="c1">#</span>
<span class="k">select</span> <span class="n">id</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="ss">`month`</span> <span class="o">=</span> <span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="no">null</span><span class="p">))</span> <span class="k">as</span> <span class="s2">&quot;Jan_Revenue&quot;</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="ss">`month`</span> <span class="o">=</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="no">null</span><span class="p">))</span> <span class="k">as</span> <span class="s2">&quot;Feb_Revenue&quot;</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="ss">`month`</span> <span class="o">=</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="no">null</span><span class="p">))</span> <span class="k">as</span> <span class="s2">&quot;Mar_Revenue&quot;</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="ss">`month`</span> <span class="o">=</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="no">null</span><span class="p">))</span> <span class="k">as</span> <span class="s2">&quot;Apr_Revenue&quot;</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="ss">`month`</span> <span class="o">=</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="no">null</span><span class="p">))</span> <span class="k">as</span> <span class="s2">&quot;May_Revenue&quot;</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="ss">`month`</span> <span class="o">=</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="no">null</span><span class="p">))</span> <span class="k">as</span> <span class="s2">&quot;Jun_Revenue&quot;</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="ss">`month`</span> <span class="o">=</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="no">null</span><span class="p">))</span> <span class="k">as</span> <span class="s2">&quot;Jul_Revenue&quot;</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="ss">`month`</span> <span class="o">=</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="no">null</span><span class="p">))</span> <span class="k">as</span> <span class="s2">&quot;Aug_Revenue&quot;</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="ss">`month`</span> <span class="o">=</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="no">null</span><span class="p">))</span> <span class="k">as</span> <span class="s2">&quot;Sep_Revenue&quot;</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="ss">`month`</span> <span class="o">=</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="no">null</span><span class="p">))</span> <span class="k">as</span> <span class="s2">&quot;Oct_Revenue&quot;</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="ss">`month`</span> <span class="o">=</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="no">null</span><span class="p">))</span> <span class="k">as</span> <span class="s2">&quot;Nov_Revenue&quot;</span><span class="p">,</span>
<span class="nf">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="ss">`month`</span> <span class="o">=</span> <span class="s1">&#39;Dec&#39;</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="no">null</span><span class="p">))</span> <span class="k">as</span> <span class="s2">&quot;Dec_Revenue&quot;</span>
<span class="k">from</span> <span class="n">Department</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">id</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="medium">
<h1>Medium<a class="headerlink" href="#medium" title="永久链接至标题">¶</a></h1>
<div class="section" id="n-2">
<h2>177.第N高的薪水(2)<a class="headerlink" href="#n-2" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>编写一个 SQL 查询，获取 Employee 表中第 n 高的薪水（Salary）。
+----+--------+
| Id | Salary |
+----+--------+
| 1  | 100    |
| 2  | 200    |
| 3  | 300    |
+----+--------+
例如上述 Employee 表，n = 2 时，应返回第二高的薪水 200。如果不存在第 n 高的薪水，那么查询应返回 null。
+------------------------+
| getNthHighestSalary(2) |
+------------------------+
| 200                    |
+------------------------+
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>单表查询</td>
</tr>
<tr>
<td>02</td>
<td>子查询</td>
</tr>
</tbody>
</table><div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="n">FUNCTION</span> <span class="nf">getNthHighestSalary</span><span class="p">(</span><span class="n">N</span> <span class="kt">INT</span><span class="p">)</span> <span class="n">RETURNS</span> <span class="kt">INT</span>
<span class="n">BEGIN</span>
  <span class="kt">SET</span> <span class="n">N</span> <span class="p">:</span><span class="o">=</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">RETURN</span> <span class="p">(</span>
      <span class="c1"># Write your MySQL query statement below.</span>
      <span class="k">select</span> <span class="n">Salary</span> <span class="k">from</span> <span class="n">Employee</span> <span class="k">group</span> <span class="k">by</span> <span class="n">Salary</span> <span class="k">order</span> <span class="k">by</span> <span class="n">Salary</span> <span class="k">desc</span> <span class="k">limit</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span>
  <span class="p">);</span>
<span class="n">END</span>

<span class="c1"># 2</span>
<span class="k">CREATE</span> <span class="n">FUNCTION</span> <span class="nf">getNthHighestSalary</span><span class="p">(</span><span class="n">N</span> <span class="kt">INT</span><span class="p">)</span> <span class="n">RETURNS</span> <span class="kt">INT</span>
<span class="n">BEGIN</span>
  <span class="k">RETURN</span> <span class="p">(</span>
      <span class="c1"># Write your MySQL query statement below.</span>
      <span class="k">select</span> <span class="k">distinct</span> <span class="n">e</span><span class="p">.</span><span class="n">Salary</span> <span class="k">from</span> <span class="n">Employee</span> <span class="n">e</span>
      <span class="k">where</span> <span class="p">(</span><span class="k">select</span> <span class="nf">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">Salary</span><span class="p">)</span> <span class="k">from</span> <span class="n">Employee</span> <span class="k">where</span> <span class="n">Salary</span> <span class="o">&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Salary</span><span class="p">)</span> <span class="o">=</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span>
  <span class="p">);</span>
<span class="n">END</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h2>178.分数排名(2)<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL架构
Create table If Not Exists Scores (Id int, Score DECIMAL(3,2))
Truncate table Scores
insert into Scores (Id, Score) values (&#39;1&#39;, &#39;3.5&#39;)
insert into Scores (Id, Score) values (&#39;2&#39;, &#39;3.65&#39;)
insert into Scores (Id, Score) values (&#39;3&#39;, &#39;4.0&#39;)
insert into Scores (Id, Score) values (&#39;4&#39;, &#39;3.85&#39;)
insert into Scores (Id, Score) values (&#39;5&#39;, &#39;4.0&#39;)
insert into Scores (Id, Score) values (&#39;6&#39;, &#39;3.65&#39;)

编写一个 SQL 查询来实现分数排名。
如果两个分数相同，则两个分数排名（Rank）相同。请注意，平分后的下一个名次应该是下一个连续的整数值。
换句话说，名次之间不应该有“间隔”。
+----+-------+
| Id | Score |
+----+-------+
| 1  | 3.50  |
| 2  | 3.65  |
| 3  | 4.00  |
| 4  | 3.85  |
| 5  | 4.00  |
| 6  | 3.65  |
+----+-------+
例如，根据上述给定的 Scores 表，你的查询应该返回（按分数从高到低排列）：
+-------+------+
| Score | Rank |
+-------+------+
| 4.00  | 1    |
| 4.00  | 1    |
| 3.85  | 2    |
| 3.65  | 3    |
| 3.65  | 3    |
| 3.50  | 4    |
+-------+------+
重要提示：对于 MySQL 解决方案，如果要转义用作列名的保留字，可以在关键字之前和之后使用撇号。例如 `Rank`
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>查询</td>
</tr>
<tr>
<td>02</td>
<td>dense_rank</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>select a.Score as Score,
(select count(distinct b.Score) from Scores b where b.Score &gt;= a.Score) as `Rank`
from Scores a
order by a.Score desc

# 2
# OVER() 指定分析函数工作的数据窗口大小,这个数据窗口大小可能会随着行的变化而变化
# RANK() 排序相同时会重复,总数不会变
# DENSE_RANK() 排序相同时会重复,总数会减少
# ROW_NUMBER() 会根据顺序计算
select Score, dense_rank() over(order by Score desc) as `Rank`
from Scores
</pre></div>
</div>
</div>
<div class="section" id="id14">
<h2>180.连续出现的数字(1)<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL架构
Create table If Not Exists Logs (Id int, Num int)
Truncate table Logs
insert into Logs (Id, Num) values (&#39;1&#39;, &#39;1&#39;)
insert into Logs (Id, Num) values (&#39;2&#39;, &#39;1&#39;)
insert into Logs (Id, Num) values (&#39;3&#39;, &#39;1&#39;)
insert into Logs (Id, Num) values (&#39;4&#39;, &#39;2&#39;)
insert into Logs (Id, Num) values (&#39;5&#39;, &#39;1&#39;)
insert into Logs (Id, Num) values (&#39;6&#39;, &#39;2&#39;)
insert into Logs (Id, Num) values (&#39;7&#39;, &#39;2&#39;)
编写一个 SQL 查询，查找所有至少连续出现三次的数字。
+----+-----+
| Id | Num |
+----+-----+
| 1  |  1  |
| 2  |  1  |
| 3  |  1  |
| 4  |  2  |
| 5  |  1  |
| 6  |  2  |
| 7  |  2  |
+----+-----+
例如，给定上面的 Logs 表， 1 是唯一连续出现至少三次的数字。
+-----------------+
| ConsecutiveNums |
+-----------------+
| 1               |
+-----------------+
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>3表连接</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="k">distinct</span> <span class="n">l1</span><span class="p">.</span><span class="n">Num</span> <span class="k">as</span> <span class="n">ConsecutiveNums</span>
<span class="k">from</span> <span class="n">Logs</span> <span class="n">l1</span><span class="p">,</span> <span class="n">Logs</span> <span class="n">l2</span><span class="p">,</span> <span class="n">Logs</span> <span class="n">l3</span>
<span class="k">where</span> <span class="n">l1</span><span class="p">.</span><span class="n">Id</span> <span class="o">=</span> <span class="n">l2</span><span class="p">.</span><span class="n">Id</span><span class="o">-</span><span class="mi">1</span> <span class="k">and</span> <span class="n">l2</span><span class="p">.</span><span class="n">Id</span> <span class="o">=</span> <span class="n">l3</span><span class="p">.</span><span class="n">Id</span><span class="o">-</span><span class="mi">1</span> <span class="k">and</span> <span class="n">l1</span><span class="p">.</span><span class="n">Num</span> <span class="o">=</span> <span class="n">l2</span><span class="p">.</span><span class="n">Num</span> <span class="k">and</span> <span class="n">l2</span><span class="p">.</span><span class="n">Num</span> <span class="o">=</span> <span class="n">l3</span><span class="p">.</span><span class="n">Num</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h2>184.部门工资最高的员工(2)<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL架构
Create table If Not Exists Employee (Id int, Name varchar(255), Salary int, DepartmentId int)
Create table If Not Exists Department (Id int, Name varchar(255))
Truncate table Employee
insert into Employee (Id, Name, Salary, DepartmentId) values (&#39;1&#39;, &#39;Joe&#39;, &#39;70000&#39;, &#39;1&#39;)
insert into Employee (Id, Name, Salary, DepartmentId) values (&#39;2&#39;, &#39;Jim&#39;, &#39;90000&#39;, &#39;1&#39;)
insert into Employee (Id, Name, Salary, DepartmentId) values (&#39;3&#39;, &#39;Henry&#39;, &#39;80000&#39;, &#39;2&#39;)
insert into Employee (Id, Name, Salary, DepartmentId) values (&#39;4&#39;, &#39;Sam&#39;, &#39;60000&#39;, &#39;2&#39;)
insert into Employee (Id, Name, Salary, DepartmentId) values (&#39;5&#39;, &#39;Max&#39;, &#39;90000&#39;, &#39;1&#39;)
Truncate table Department
insert into Department (Id, Name) values (&#39;1&#39;, &#39;IT&#39;)
insert into Department (Id, Name) values (&#39;2&#39;, &#39;Sales&#39;)

Employee 表包含所有员工信息，每个员工有其对应的 Id, salary 和 department Id。
+----+-------+--------+--------------+
| Id | Name  | Salary | DepartmentId |
+----+-------+--------+--------------+
| 1  | Joe   | 70000  | 1            |
| 2  | Jim   | 90000  | 1            |
| 3  | Henry | 80000  | 2            |
| 4  | Sam   | 60000  | 2            |
| 5  | Max   | 90000  | 1            |
+----+-------+--------+--------------+

Department 表包含公司所有部门的信息。
+----+----------+
| Id | Name     |
+----+----------+
| 1  | IT       |
| 2  | Sales    |
+----+----------+

编写一个 SQL 查询，找出每个部门工资最高的员工。
对于上述表，您的 SQL 查询应返回以下行（行的顺序无关紧要）。
+------------+----------+--------+
| Department | Employee | Salary |
+------------+----------+--------+
| IT         | Max      | 90000  |
| IT         | Jim      | 90000  |
| Sales      | Henry    | 80000  |
+------------+----------+--------+
解释：Max 和 Jim 在 IT 部门的工资都是最高的，Henry 在销售部的工资最高。
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>join+in</td>
</tr>
<tr>
<td>02</td>
<td>子查询</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="n">Department</span><span class="p">.</span><span class="n">Name</span> <span class="k">as</span> <span class="o">`</span><span class="n">Department</span><span class="o">`</span><span class="p">,</span> <span class="n">Employee</span><span class="p">.</span><span class="n">Name</span> <span class="k">as</span> <span class="o">`</span><span class="n">Employee</span><span class="o">`</span><span class="p">,</span> <span class="n">Salary</span>
<span class="k">from</span> <span class="n">Employee</span> <span class="k">join</span> <span class="n">Department</span> <span class="k">on</span> <span class="n">Employee</span><span class="p">.</span><span class="n">DepartmentId</span> <span class="o">=</span> <span class="n">Department</span><span class="p">.</span><span class="n">Id</span>
<span class="k">where</span> <span class="p">(</span><span class="n">Employee</span><span class="p">.</span><span class="n">DepartmentId</span><span class="p">,</span> <span class="n">Salary</span><span class="p">)</span> <span class="k">in</span>
<span class="p">(</span><span class="k">select</span> <span class="n">DepartmentId</span><span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">Salary</span><span class="p">)</span> <span class="k">from</span> <span class="n">Employee</span> <span class="k">group</span> <span class="k">by</span> <span class="n">DepartmentId</span><span class="p">)</span>

<span class="o">#</span> <span class="mi">2</span>
<span class="k">select</span> <span class="n">Department</span><span class="p">.</span><span class="n">Name</span> <span class="k">as</span> <span class="o">`</span><span class="n">Department</span><span class="o">`</span><span class="p">,</span> <span class="n">Employee</span><span class="p">.</span><span class="n">Name</span> <span class="k">as</span> <span class="o">`</span><span class="n">Employee</span><span class="o">`</span><span class="p">,</span> <span class="n">Salary</span>
<span class="k">from</span> <span class="n">Employee</span> <span class="k">join</span> <span class="n">Department</span> <span class="k">on</span> <span class="n">Employee</span><span class="p">.</span><span class="n">DepartmentId</span> <span class="o">=</span> <span class="n">Department</span><span class="p">.</span><span class="n">Id</span>
<span class="k">where</span> <span class="n">Employee</span><span class="p">.</span><span class="n">Salary</span> <span class="o">=</span> <span class="p">(</span>
<span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">Salary</span><span class="p">)</span> <span class="k">from</span> <span class="n">Employee</span> <span class="k">where</span> <span class="n">Employee</span><span class="p">.</span><span class="n">DepartmentId</span> <span class="o">=</span> <span class="n">Department</span><span class="p">.</span><span class="n">Id</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id16">
<h2>626.换座位(2)<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL架构
Create table If Not Exists seat(id int, student varchar(255))
Truncate table seat
insert into seat (id, student) values (&#39;1&#39;, &#39;Abbot&#39;)
insert into seat (id, student) values (&#39;2&#39;, &#39;Doris&#39;)
insert into seat (id, student) values (&#39;3&#39;, &#39;Emerson&#39;)
insert into seat (id, student) values (&#39;4&#39;, &#39;Green&#39;)
insert into seat (id, student) values (&#39;5&#39;, &#39;Jeames&#39;)

小美是一所中学的信息科技老师，她有一张 seat 座位表，平时用来储存学生名字和与他们相对应的座位 id。
其中纵列的 id 是连续递增的
小美想改变相邻俩学生的座位。
你能不能帮她写一个 SQL query 来输出小美想要的结果呢？
示例：
+---------+---------+
|    id   | student |
+---------+---------+
|    1    | Abbot   |
|    2    | Doris   |
|    3    | Emerson |
|    4    | Green   |
|    5    | Jeames  |
+---------+---------+
假如数据输入的是上表，则输出结果如下：
+---------+---------+
|    id   | student |
+---------+---------+
|    1    | Doris   |
|    2    | Abbot   |
|    3    | Green   |
|    4    | Emerson |
|    5    | Jeames  |
+---------+---------+
注意：如果学生人数是奇数，则不需要改变最后一个同学的座位。
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>case when</td>
</tr>
<tr>
<td>02</td>
<td>coalesce</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="p">(</span><span class="k">case</span>
    <span class="k">when</span> <span class="k">mod</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span> <span class="k">and</span> <span class="n">total</span> <span class="o">!=</span> <span class="n">id</span> <span class="k">then</span> <span class="n">id</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">when</span> <span class="k">mod</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span> <span class="k">and</span> <span class="n">total</span> <span class="o">=</span> <span class="n">id</span> <span class="k">then</span> <span class="n">id</span>
    <span class="k">else</span> <span class="n">id</span><span class="o">-</span><span class="mi">1</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="n">id</span><span class="p">,</span> <span class="n">student</span>
<span class="k">from</span>  <span class="n">seat</span><span class="p">,</span> <span class="p">(</span> <span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">total</span> <span class="k">from</span> <span class="n">seat</span><span class="p">)</span> <span class="k">as</span> <span class="n">seat_counts</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">id</span> <span class="k">asc</span> 

<span class="o">#</span> <span class="mi">2</span>
<span class="k">select</span> <span class="n">s1</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">coalesce</span><span class="p">(</span><span class="n">s2</span><span class="p">.</span><span class="n">student</span><span class="p">,</span> <span class="n">s1</span><span class="p">.</span><span class="n">student</span><span class="p">)</span> <span class="k">AS</span> <span class="n">student</span>
<span class="k">from</span> <span class="n">seat</span> <span class="n">s1</span> <span class="k">left</span> <span class="k">join</span> <span class="n">seat</span> <span class="n">s2</span> <span class="k">on</span> <span class="p">((</span><span class="n">s1</span><span class="p">.</span><span class="n">id</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">^</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">=</span><span class="n">s2</span><span class="p">.</span><span class="n">id</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">s1</span><span class="p">.</span><span class="n">id</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="hard">
<h1>Hard<a class="headerlink" href="#hard" title="永久链接至标题">¶</a></h1>
<div class="section" id="id17">
<h2>185.部门工资前三高的所有员工(2)<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL架构
Create table If Not Exists Employee (Id int, Name varchar(255), Salary int, DepartmentId int)
Create table If Not Exists Department (Id int, Name varchar(255))
Truncate table Employee
insert into Employee (Id, Name, Salary, DepartmentId) values (&#39;1&#39;, &#39;Joe&#39;, &#39;85000&#39;, &#39;1&#39;)
insert into Employee (Id, Name, Salary, DepartmentId) values (&#39;2&#39;, &#39;Henry&#39;, &#39;80000&#39;, &#39;2&#39;)
insert into Employee (Id, Name, Salary, DepartmentId) values (&#39;3&#39;, &#39;Sam&#39;, &#39;60000&#39;, &#39;2&#39;)
insert into Employee (Id, Name, Salary, DepartmentId) values (&#39;4&#39;, &#39;Max&#39;, &#39;90000&#39;, &#39;1&#39;)
insert into Employee (Id, Name, Salary, DepartmentId) values (&#39;5&#39;, &#39;Janet&#39;, &#39;69000&#39;, &#39;1&#39;)
insert into Employee (Id, Name, Salary, DepartmentId) values (&#39;6&#39;, &#39;Randy&#39;, &#39;85000&#39;, &#39;1&#39;)
insert into Employee (Id, Name, Salary, DepartmentId) values (&#39;7&#39;, &#39;Will&#39;, &#39;70000&#39;, &#39;1&#39;)
Truncate table Department
insert into Department (Id, Name) values (&#39;1&#39;, &#39;IT&#39;)
insert into Department (Id, Name) values (&#39;2&#39;, &#39;Sales&#39;)
Employee 表包含所有员工信息，每个员工有其对应的工号 Id，
姓名 Name，工资 Salary 和部门编号 DepartmentId 。
+----+-------+--------+--------------+
| Id | Name  | Salary | DepartmentId |
+----+-------+--------+--------------+
| 1  | Joe   | 85000  | 1            |
| 2  | Henry | 80000  | 2            |
| 3  | Sam   | 60000  | 2            |
| 4  | Max   | 90000  | 1            |
| 5  | Janet | 69000  | 1            |
| 6  | Randy | 85000  | 1            |
| 7  | Will  | 70000  | 1            |
+----+-------+--------+--------------+
Department 表包含公司所有部门的信息。
+----+----------+
| Id | Name     |
+----+----------+
| 1  | IT       |
| 2  | Sales    |
+----+----------+
编写一个 SQL 查询，找出每个部门获得前三高工资的所有员工。例如，根据上述给定的表，查询结果应返回：
+------------+----------+--------+
| Department | Employee | Salary |
+------------+----------+--------+
| IT         | Max      | 90000  |
| IT         | Randy    | 85000  |
| IT         | Joe      | 85000  |
| IT         | Will     | 70000  |
| Sales      | Henry    | 80000  |
| Sales      | Sam      | 60000  |
+------------+----------+--------+
解释：IT 部门中，Max 获得了最高的工资，Randy 和 Joe 都拿到了第二高的工资，Will 的工资排第三。
销售部门（Sales）只有两名员工，Henry 的工资最高，Sam 的工资排第二。
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>join+子查询</td>
</tr>
<tr>
<td>02</td>
<td>dense_rank函数</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="n">Department</span><span class="p">.</span><span class="n">Name</span> <span class="k">as</span> <span class="o">`</span><span class="n">Department</span><span class="o">`</span><span class="p">,</span> <span class="n">Employee</span><span class="p">.</span><span class="n">Name</span> <span class="k">as</span> <span class="o">`</span><span class="n">Employee</span><span class="o">`</span><span class="p">,</span> <span class="n">Salary</span>
<span class="k">from</span> <span class="n">Employee</span> <span class="k">join</span> <span class="n">Department</span> <span class="k">on</span> <span class="n">Employee</span><span class="p">.</span><span class="n">DepartmentId</span> <span class="o">=</span> <span class="n">Department</span><span class="p">.</span><span class="n">Id</span>
<span class="k">where</span> <span class="mi">3</span> <span class="o">&gt;</span>
<span class="p">(</span><span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">e2</span><span class="p">.</span><span class="n">Salary</span><span class="p">)</span> <span class="k">from</span> <span class="n">Employee</span> <span class="n">e2</span> 
<span class="k">where</span> <span class="n">e2</span><span class="p">.</span><span class="n">Salary</span> <span class="o">&gt;</span> <span class="n">Employee</span><span class="p">.</span><span class="n">Salary</span> <span class="k">and</span> <span class="n">e2</span><span class="p">.</span><span class="n">DepartmentId</span> <span class="o">=</span> <span class="n">Employee</span><span class="p">.</span><span class="n">DepartmentId</span> <span class="p">)</span>

<span class="o">#</span> <span class="mi">2</span>
<span class="k">select</span> <span class="n">d</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="o">`</span><span class="n">Department</span><span class="o">`</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="o">`</span><span class="n">Employee</span><span class="o">`</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">Salary</span>
<span class="k">from</span><span class="p">(</span><span class="k">select</span> <span class="o">*</span><span class="p">,</span><span class="n">dense_rank</span><span class="p">()</span> <span class="n">over</span><span class="p">(</span><span class="n">partition</span> <span class="k">by</span> <span class="n">DepartmentId</span> <span class="k">order</span> <span class="k">by</span> <span class="n">salary</span> <span class="k">desc</span><span class="p">)</span> <span class="k">as</span> <span class="n">ranking</span> <span class="k">from</span> <span class="n">Employee</span><span class="p">)</span> <span class="k">as</span> <span class="n">a</span><span class="p">,</span>
<span class="n">department</span> <span class="k">as</span> <span class="n">d</span>
<span class="k">where</span> <span class="n">a</span><span class="p">.</span><span class="n">DepartmentId</span> <span class="o">=</span> <span class="n">d</span><span class="p">.</span><span class="n">Id</span> <span class="k">and</span> <span class="n">ranking</span><span class="o">&lt;=</span><span class="mi">3</span>
</pre></div>
</div>
</div>
<div class="section" id="id18">
<h2>262.行程和用户(2)<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL架构
Create table If Not Exists Trips (Id int, Client_Id int, Driver_Id int, City_Id int, Status ENUM(&#39;completed&#39;, &#39;cancelled_by_driver&#39;, &#39;cancelled_by_client&#39;), Request_at varchar(50))
Create table If Not Exists Users (Users_Id int, Banned varchar(50), Role ENUM(&#39;client&#39;, &#39;driver&#39;, &#39;partner&#39;))
Truncate table Trips
insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (&#39;1&#39;, &#39;1&#39;, &#39;10&#39;, &#39;1&#39;, &#39;completed&#39;, &#39;2013-10-01&#39;)
insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (&#39;2&#39;, &#39;2&#39;, &#39;11&#39;, &#39;1&#39;, &#39;cancelled_by_driver&#39;, &#39;2013-10-01&#39;)
insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (&#39;3&#39;, &#39;3&#39;, &#39;12&#39;, &#39;6&#39;, &#39;completed&#39;, &#39;2013-10-01&#39;)
insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (&#39;4&#39;, &#39;4&#39;, &#39;13&#39;, &#39;6&#39;, &#39;cancelled_by_client&#39;, &#39;2013-10-01&#39;)
insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (&#39;5&#39;, &#39;1&#39;, &#39;10&#39;, &#39;1&#39;, &#39;completed&#39;, &#39;2013-10-02&#39;)
insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (&#39;6&#39;, &#39;2&#39;, &#39;11&#39;, &#39;6&#39;, &#39;completed&#39;, &#39;2013-10-02&#39;)
insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (&#39;7&#39;, &#39;3&#39;, &#39;12&#39;, &#39;6&#39;, &#39;completed&#39;, &#39;2013-10-02&#39;)
insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (&#39;8&#39;, &#39;2&#39;, &#39;12&#39;, &#39;12&#39;, &#39;completed&#39;, &#39;2013-10-03&#39;)
insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (&#39;9&#39;, &#39;3&#39;, &#39;10&#39;, &#39;12&#39;, &#39;completed&#39;, &#39;2013-10-03&#39;)
insert into Trips (Id, Client_Id, Driver_Id, City_Id, Status, Request_at) values (&#39;10&#39;, &#39;4&#39;, &#39;13&#39;, &#39;12&#39;, &#39;cancelled_by_driver&#39;, &#39;2013-10-03&#39;)
Truncate table Users
insert into Users (Users_Id, Banned, Role) values (&#39;1&#39;, &#39;No&#39;, &#39;client&#39;)
insert into Users (Users_Id, Banned, Role) values (&#39;2&#39;, &#39;Yes&#39;, &#39;client&#39;)
insert into Users (Users_Id, Banned, Role) values (&#39;3&#39;, &#39;No&#39;, &#39;client&#39;)
insert into Users (Users_Id, Banned, Role) values (&#39;4&#39;, &#39;No&#39;, &#39;client&#39;)
insert into Users (Users_Id, Banned, Role) values (&#39;10&#39;, &#39;No&#39;, &#39;driver&#39;)
insert into Users (Users_Id, Banned, Role) values (&#39;11&#39;, &#39;No&#39;, &#39;driver&#39;)
insert into Users (Users_Id, Banned, Role) values (&#39;12&#39;, &#39;No&#39;, &#39;driver&#39;)
insert into Users (Users_Id, Banned, Role) values (&#39;13&#39;, &#39;No&#39;, &#39;driver&#39;)

Trips 表中存所有出租车的行程信息。每段行程有唯一键 Id，
Client_Id 和 Driver_Id 是 Users 表中 Users_Id 的外键。
Status 是枚举类型，枚举成员为 (‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’)。
+----+-----------+-----------+---------+--------------------+----------+
| Id | Client_Id | Driver_Id | City_Id |        Status      |Request_at|
+----+-----------+-----------+---------+--------------------+----------+
| 1  |     1     |    10     |    1    |     completed      |2013-10-01|
| 2  |     2     |    11     |    1    | cancelled_by_driver|2013-10-01|
| 3  |     3     |    12     |    6    |     completed      |2013-10-01|
| 4  |     4     |    13     |    6    | cancelled_by_client|2013-10-01|
| 5  |     1     |    10     |    1    |     completed      |2013-10-02|
| 6  |     2     |    11     |    6    |     completed      |2013-10-02|
| 7  |     3     |    12     |    6    |     completed      |2013-10-02|
| 8  |     2     |    12     |    12   |     completed      |2013-10-03|
| 9  |     3     |    10     |    12   |     completed      |2013-10-03| 
| 10 |     4     |    13     |    12   | cancelled_by_driver|2013-10-03|
+----+-----------+-----------+---------+--------------------+----------+
Users 表存所有用户。每个用户有唯一键 Users_Id。Banned 表示这个用户是否被禁止，
Role 则是一个表示（‘client’, ‘driver’, ‘partner’）的枚举类型。
+----------+--------+--------+
| Users_Id | Banned |  Role  |
+----------+--------+--------+
|    1     |   No   | client |
|    2     |   Yes  | client |
|    3     |   No   | client |
|    4     |   No   | client |
|    10    |   No   | driver |
|    11    |   No   | driver |
|    12    |   No   | driver |
|    13    |   No   | driver |
+----------+--------+--------+
写一段 SQL 语句查出 2013年10月1日 至 2013年10月3日 期间非禁止用户的取消率。
基于上表，你的 SQL 语句应返回如下结果，取消率（Cancellation Rate）保留两位小数。
取消率的计算方式如下：(被司机或乘客取消的非禁止用户生成的订单数量) / (非禁止用户生成的订单总数)
+------------+-------------------+
|     Day    | Cancellation Rate |
+------------+-------------------+
| 2013-10-01 |       0.33        |
| 2013-10-02 |       0.00        |
| 2013-10-03 |       0.50        |
+------------+-------------------+
致谢:非常感谢 @cak1erlizhou 详细的提供了这道题和相应的测试用例。
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>聚合</td>
</tr>
<tr>
<td>02</td>
<td>聚合</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="n">t</span><span class="p">.</span><span class="n">Request_at</span> <span class="k">as</span> <span class="o">`</span><span class="k">Day</span><span class="o">`</span><span class="p">,</span> <span class="n">Round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">Status</span><span class="o">=</span><span class="s1">&#39;completed&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="k">count</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">Status</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="o">`</span><span class="n">Cancellation</span> <span class="n">Rate</span><span class="o">`</span>
<span class="k">from</span> <span class="n">Trips</span> <span class="k">as</span> <span class="n">t</span>
<span class="k">join</span> <span class="n">Users</span> <span class="k">as</span> <span class="n">u1</span> <span class="k">on</span> <span class="n">t</span><span class="p">.</span><span class="n">Client_Id</span><span class="o">=</span><span class="n">u1</span><span class="p">.</span><span class="n">Users_Id</span> <span class="k">and</span> <span class="n">u1</span><span class="p">.</span><span class="n">Banned</span><span class="o">=</span><span class="s1">&#39;No&#39;</span>
<span class="k">join</span> <span class="n">Users</span> <span class="k">as</span> <span class="n">u2</span> <span class="k">on</span> <span class="n">t</span><span class="p">.</span><span class="n">Driver_Id</span><span class="o">=</span><span class="n">u2</span><span class="p">.</span><span class="n">Users_Id</span> <span class="k">and</span> <span class="n">u2</span><span class="p">.</span><span class="n">Banned</span><span class="o">=</span><span class="s1">&#39;No&#39;</span>
<span class="k">where</span> <span class="n">t</span><span class="p">.</span><span class="n">Request_at</span> <span class="k">between</span> <span class="s1">&#39;2013-10-01&#39;</span> <span class="k">and</span> <span class="s1">&#39;2013-10-03&#39;</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">t</span><span class="p">.</span><span class="n">Request_at</span>

<span class="o">#</span> <span class="mi">2</span>
<span class="k">select</span> <span class="n">t</span><span class="p">.</span><span class="n">Request_at</span> <span class="k">as</span> <span class="o">`</span><span class="k">Day</span><span class="o">`</span><span class="p">,</span> <span class="n">Round</span><span class="p">(</span><span class="k">avg</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">Status</span><span class="o">!=</span><span class="s1">&#39;completed&#39;</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="o">`</span><span class="n">Cancellation</span> <span class="n">Rate</span><span class="o">`</span>
<span class="k">from</span> <span class="n">Trips</span> <span class="k">as</span> <span class="n">t</span>
<span class="k">join</span> <span class="n">Users</span> <span class="k">as</span> <span class="n">u1</span> <span class="k">on</span> <span class="n">t</span><span class="p">.</span><span class="n">Client_Id</span><span class="o">=</span><span class="n">u1</span><span class="p">.</span><span class="n">Users_Id</span> <span class="k">and</span> <span class="n">u1</span><span class="p">.</span><span class="n">Banned</span><span class="o">=</span><span class="s1">&#39;No&#39;</span>
<span class="k">join</span> <span class="n">Users</span> <span class="k">as</span> <span class="n">u2</span> <span class="k">on</span> <span class="n">t</span><span class="p">.</span><span class="n">Driver_Id</span><span class="o">=</span><span class="n">u2</span><span class="p">.</span><span class="n">Users_Id</span> <span class="k">and</span> <span class="n">u2</span><span class="p">.</span><span class="n">Banned</span><span class="o">=</span><span class="s1">&#39;No&#39;</span>
<span class="k">where</span> <span class="n">t</span><span class="p">.</span><span class="n">Request_at</span> <span class="k">between</span> <span class="s1">&#39;2013-10-01&#39;</span> <span class="k">and</span> <span class="s1">&#39;2013-10-03&#39;</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">t</span><span class="p">.</span><span class="n">Request_at</span>
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h2>601.体育馆的人流量(2)<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>题目</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL架构
Create table If Not Exists stadium (id int, visit_date DATE NULL, people int)
Truncate table stadium
insert into stadium (id, visit_date, people) values (&#39;1&#39;, &#39;2017-01-01&#39;, &#39;10&#39;)
insert into stadium (id, visit_date, people) values (&#39;2&#39;, &#39;2017-01-02&#39;, &#39;109&#39;)
insert into stadium (id, visit_date, people) values (&#39;3&#39;, &#39;2017-01-03&#39;, &#39;150&#39;)
insert into stadium (id, visit_date, people) values (&#39;4&#39;, &#39;2017-01-04&#39;, &#39;99&#39;)
insert into stadium (id, visit_date, people) values (&#39;5&#39;, &#39;2017-01-05&#39;, &#39;145&#39;)
insert into stadium (id, visit_date, people) values (&#39;6&#39;, &#39;2017-01-06&#39;, &#39;1455&#39;)
insert into stadium (id, visit_date, people) values (&#39;7&#39;, &#39;2017-01-07&#39;, &#39;199&#39;)
insert into stadium (id, visit_date, people) values (&#39;8&#39;, &#39;2017-01-08&#39;, &#39;188&#39;)

X 市建了一个新的体育馆，每日人流量信息被记录在这三列信息中：序号 (id)、日期 (visit_date)、
人流量 (people)。
请编写一个查询语句，找出人流量的高峰期。高峰期时，至少连续三行记录中的人流量不少于100。
例如，表 stadium：
+------+------------+-----------+
| id   | visit_date | people    |
+------+------------+-----------+
| 1    | 2017-01-01 | 10        |
| 2    | 2017-01-02 | 109       |
| 3    | 2017-01-03 | 150       |
| 4    | 2017-01-04 | 99        |
| 5    | 2017-01-05 | 145       |
| 6    | 2017-01-06 | 1455      |
| 7    | 2017-01-07 | 199       |
| 8    | 2017-01-08 | 188       |
+------+------------+-----------+
对于上面的示例数据，输出为：
+------+------------+-----------+
| id   | visit_date | people    |
+------+------------+-----------+
| 5    | 2017-01-05 | 145       |
| 6    | 2017-01-06 | 1455      |
| 7    | 2017-01-07 | 199       |
| 8    | 2017-01-08 | 188       |
+------+------------+-----------+
提示：每天只有一行记录，日期随着 id 的增加而增加。
    体育馆并不是每天都开放的，所以记录中的日期可能会出现断层。
</pre></div>
</div>
<ul class="simple">
<li>解题思路</li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>No.</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>连接</td>
</tr>
<tr>
<td>02</td>
<td>连接</td>
</tr>
</tbody>
</table><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="k">distinct</span> <span class="n">t1</span><span class="p">.</span><span class="o">*</span>
<span class="k">from</span> <span class="n">stadium</span> <span class="n">t1</span><span class="p">,</span> <span class="n">stadium</span> <span class="n">t2</span><span class="p">,</span> <span class="n">stadium</span> <span class="n">t3</span>
<span class="k">where</span> <span class="n">t1</span><span class="p">.</span><span class="n">people</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="k">and</span> <span class="n">t2</span><span class="p">.</span><span class="n">people</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="k">and</span> <span class="n">t3</span><span class="p">.</span><span class="n">people</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="k">and</span>
<span class="p">(</span>
    <span class="p">(</span><span class="n">t1</span><span class="p">.</span><span class="n">id</span><span class="o">-</span><span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span> <span class="k">and</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span><span class="o">-</span><span class="n">t3</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="mi">2</span> <span class="k">and</span> <span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="o">-</span><span class="n">t3</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">or</span>
    <span class="p">(</span><span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="o">-</span><span class="n">t1</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span> <span class="k">and</span> <span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="o">-</span><span class="n">t3</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="mi">2</span> <span class="k">and</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span><span class="o">-</span><span class="n">t3</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">or</span>
    <span class="p">(</span><span class="n">t3</span><span class="p">.</span><span class="n">id</span><span class="o">-</span><span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span> <span class="k">and</span> <span class="n">t3</span><span class="p">.</span><span class="n">id</span><span class="o">-</span><span class="n">t1</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="mi">2</span> <span class="k">and</span> <span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="o">-</span><span class="n">t1</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span>

<span class="o">#</span> <span class="mi">2</span>
<span class="k">select</span> <span class="k">distinct</span> <span class="n">stadium</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">visit_date</span><span class="p">,</span> <span class="n">people</span>
<span class="k">from</span> <span class="n">stadium</span><span class="p">,(</span><span class="k">select</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="k">from</span> <span class="n">stadium</span> <span class="n">t1</span><span class="p">,</span><span class="n">stadium</span> <span class="n">t2</span><span class="p">,</span><span class="n">stadium</span> <span class="n">t3</span> <span class="k">where</span> 
    <span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="o">-</span> <span class="n">t2</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">and</span> 
    <span class="n">t2</span><span class="p">.</span><span class="n">id</span> <span class="o">-</span> <span class="n">t3</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">and</span> 
    <span class="n">t1</span><span class="p">.</span><span class="n">people</span> <span class="o">&gt;=</span><span class="mi">100</span> <span class="k">and</span> <span class="n">t2</span><span class="p">.</span><span class="n">people</span> <span class="o">&gt;=</span><span class="mi">100</span> <span class="k">and</span> <span class="n">t3</span><span class="p">.</span><span class="n">people</span> <span class="o">&gt;=</span><span class="mi">100</span>
<span class="p">)</span> <span class="n">t</span>
<span class="k">where</span> <span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">id</span> <span class="o">-</span> <span class="n">stadium</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="k">between</span> <span class="mi">0</span> <span class="k">and</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="patB.html" class="btn btn-neutral float-right" title="PAT (Basic Level) Practice 乙级" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="lcp.html" class="btn btn-neutral float-left" title="LCP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2021, willshang.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>